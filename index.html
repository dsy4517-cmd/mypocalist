<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ìè¨Ïπ¥ Î¶¨Ïä§Ìä∏</title>
<style>
body { font-family: Arial; background:#f5f5f5; text-align:center; margin:0; }
.counter { font-weight:bold; color:#333; margin-bottom:10px; padding:15px 0; }
.input-box { padding:10px; }
input, button { padding:6px; margin:3px; border-radius:10px; border:1px solid #ccc; }
button { border:none; background:#999; color:white; cursor:pointer; }
.grid { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; padding:10px; }
.card { background:white; border-radius:15px; padding:10px; position:relative; cursor:pointer; transition:0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
.card.owned { background:#666; color:white; }
.delete { position:absolute; top:5px; right:5px; font-size:12px; cursor:pointer; }
.card img { width:100%; border-radius:10px; }
.editBtn { margin-top:5px; background:#ddd; color:#333; border-radius:5px; border:1px solid #aaa; padding:2px 5px; font-size:12px; cursor:pointer; }
.highlight { background: yellow; color: black; border-radius:3px; }

/* Î™®Îã¨ */
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; }
.modal img { max-width:90%; max-height:90%; border-radius:15px; touch-action: none; }
</style>
</head>
<body>

<div class="counter" id="counter">0Ïû• (0%)</div>

<div class="input-box">
  <input type="file" id="fileInput" accept="image/*">
  <input id="member" placeholder="Î©§Î≤Ñ">
  <input id="album" placeholder="Ïï®Î≤î">
  <input id="grade" placeholder="Îì±Í∏â">
  <button onclick="addFile()">Ï∂îÍ∞Ä</button>
  <br>
  <input id="searchInput" placeholder="Î©§Î≤Ñ/Ïï®Î≤î/Îì±Í∏â Í≤ÄÏÉâ" oninput="render()">
</div>

<div class="grid" id="grid"></div>

<!-- Î™®Îã¨ -->
<div id="modal" class="modal">
  <img id="modalImg" src="">
</div>

<script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
<script>
// Îç∞Ïù¥ÌÑ∞
let cards = JSON.parse(localStorage.getItem("pocaData")) || [];
const grid = document.getElementById("grid");
const counter = document.getElementById("counter");
const modal = document.getElementById("modal");
const modalImg = document.getElementById("modalImg");
let currentIndex = 0;
let scale = 1;

// Ï†ÄÏû• + Ïπ¥Ïö¥ÌÑ∞
function save(){ localStorage.setItem("pocaData", JSON.stringify(cards)); updateCounter(); }
function updateCounter(){ const owned = cards.filter(c=>c.owned).length; const total = cards.length; counter.innerText = `üíñ ${owned} / ${total} (${Math.round((owned/total)*100)}%)`; }

// ÌïòÏù¥ÎùºÏù¥Ìä∏
function highlight(text, query){ if(!query) return text; const regex = new RegExp(`(${query})`, 'gi'); return text.replace(regex, '<span class="highlight">$1</span>'); }

// Î†åÎçî
function render(){
  const query = document.getElementById("searchInput").value.toLowerCase();
  grid.innerHTML="";
  cards.forEach((card,index)=>{
    const searchable = `${card.member} ${card.album} ${card.grade}`.toLowerCase();
    if(searchable.includes(query)){
      const div=document.createElement("div");
      div.className="card";
      if(card.owned) div.classList.add("owned");

      div.innerHTML=`
        <div class="delete" onclick="deleteCard(${index},event)">‚ùå</div>
        <img src="${card.img}" alt="Ìè¨Ïπ¥" onclick="openModal(${index}, event)">
        <div><b>${highlight(card.member, query)}</b></div>
        <div>${highlight(card.album, query)}</div>
        <div>${highlight(card.grade, query)}</div>
        <button class="editBtn" onclick="editCard(${index},event)">‚úèÔ∏è ÏàòÏ†ï</button>
      `;

      div.onclick=function(){ card.owned=!card.owned; render(); }
      grid.appendChild(div);
    }
  });
  save();
}

// ÏàòÏ†ï
function editCard(index,e){ e.stopPropagation(); const card=cards[index]; const m=prompt("Î©§Î≤Ñ Ïù¥Î¶Ñ:", card.member); const a=prompt("Ïï®Î≤î Ïù¥Î¶Ñ:", card.album); const g=prompt("Îì±Í∏â:", card.grade); if(m) card.member=m; if(a) card.album=a; if(g) card.grade=g; render(); }

// Ï∂îÍ∞Ä
function addFile(){
  const file=document.getElementById("fileInput").files[0];
  const member=document.getElementById("member").value;
  const album=document.getElementById("album").value;
  const grade=document.getElementById("grade").value;
  if(!file) return;
  const reader=new FileReader();
  reader.onload=function(e){ cards.push({img:e.target.result, member, album, grade, owned:false}); render(); }
  reader.readAsDataURL(file);
  document.getElementById("fileInput").value="";
  document.getElementById("member").value="";
  document.getElementById("album").value="";
  document.getElementById("grade").value="";
}

// ÏÇ≠Ï†ú
function deleteCard(index,e){ e.stopPropagation(); cards.splice(index,1); render(); }

// Î™®Îã¨ Ïó¥Í∏∞
function openModal(index, e){
  e.stopPropagation();
  currentIndex = index;
  modal.style.display = "flex";
  modalImg.src = cards[index].img;
  scale = 1;
  modalImg.style.transform = `scale(${scale})`;

  const hammer = new Hammer(modalImg);
  hammer.get('pinch').set({ enable: true });
  hammer.get('swipe').set({ direction: Hammer.DIRECTION_HORIZONTAL });
  hammer.on('pinch', function(ev){ scale = ev.scale; modalImg.style.transform = `scale(${scale})`; });
  hammer.on('swipe', function(ev){
    if(ev.direction === Hammer.DIRECTION_LEFT) nextCard();
    if(ev.direction === Hammer.DIRECTION_RIGHT) prevCard();
  });
}

// Ïπ¥Îìú Ïù¥Îèô
function nextCard(){ if(currentIndex < cards.length-1){ currentIndex++; modalImg.src = cards[currentIndex].img; scale=1; modalImg.style.transform="scale(1)"; } }
function prevCard(){ if(currentIndex > 0){ currentIndex--; modalImg.src = cards[currentIndex].img; scale=1; modalImg.style.transform="scale(1)"; } }

// Î™®Îã¨ Îã´Í∏∞
modal.addEventListener('click',()=>{ modal.style.display="none"; });

render();
</script>
</body>
</html>
